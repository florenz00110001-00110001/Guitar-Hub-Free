<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Guitar Hub Trainer</title>
<style>
body { font-family: Arial, Helvetica, sans-serif; background:#111; color:white; text-align:center; margin:0; padding:0;}
header { width:100%; background:#000; padding:10px 20px; display:flex; justify-content:space-between; align-items:center; position:fixed; top:0; left:0; z-index:1000;}
.logo { display:flex; align-items:center; font-weight:bold; font-size:1.4em;}
.logo span.guitar { color:black; }
.logo span.hub { color:black; background:yellow; padding:4px 8px; border-radius:4px; margin-left:5px;}
main { padding-top:70px;}
button { padding:10px 20px; margin:10px; background:orange; border:none; border-radius:8px; cursor:pointer;}
.hidden { display:none; }
.chord-grid { display:flex; flex-wrap:wrap; justify-content:center; gap:15px; padding:20px; }
.chord-card { background:#222; padding:10px; border-radius:10px; width:100px; text-align:center; }
.chord-img { width:80px; margin-top:5px; }
#pattern-display, #chord-mistakes, #strum-status, #strum-mistakes { margin-top:15px; }
audio { margin-top:15px; width:80%; }
.light-mode { background:#eee; color:#111; }
.light-mode .chord-card { background:#ccc; color:#111; }
</style>
</head>
<body>

<header>
  <div class="logo"><span class="guitar">Guitar</span><span class="hub">Hub</span></div>
  <button id="mode-toggle">Toggle Dark/Light</button>
</header>

<main>
<div id="main-menu">
  <h2>Main Menu</h2>
  <button onclick="showViewChords()">View Chords</button>
  <button onclick="showPracticeChords()">Practice Chords</button>
  <button onclick="showStrum()">Practice Strum</button>
</div>

<!-- View Chords -->
<div id="view-chords" class="hidden">
  <h2>All Chords</h2>
  <div id="chord-grid-view" class="chord-grid"></div>
  <button onclick="goBack()">⬅ Back</button>
</div>

<!-- Chord Practice -->
<div id="practice-chords" class="hidden">
  <h2>Practice Chords</h2>
  <div id="current-chord" style="font-size:2em; margin:20px;"></div>
  <button id="start-chord-rec">Start Listening</button>
  <p id="chord-mistakes">You have (0) mistakes wrong</p>
  <button onclick="restartChords()">Restart</button>
  <button onclick="goBack()">⬅ Back</button>
</div>

<!-- Strum Practice -->
<div id="strum" class="hidden">
  <h2>Strumming Practice</h2>
  <select id="song-select"></select>
  <button id="start-strum-rec">Start Recording</button>
  <div id="pattern-display"></div>
  <p id="strum-status">Record your strum</p>
  <p id="strum-mistakes">You have (0) mistakes wrong</p>
  <audio id="audio-playback" controls class="hidden"></audio>
  <button onclick="restartStrum()">Restart</button>
  <button onclick="goBack()">⬅ Back</button>
</div>

</main>

<script>
document.addEventListener('DOMContentLoaded', () => {

  // Dark/Light toggle
  document.getElementById('mode-toggle').addEventListener('click', ()=>{
    document.body.classList.toggle('light-mode');
  });

  // Menu functions
  const mainMenu = document.getElementById('main-menu');
  const viewChordsDiv = document.getElementById('view-chords');
  const practiceChordsDiv = document.getElementById('practice-chords');
  const strumDiv = document.getElementById('strum');

  window.showViewChords = () => { mainMenu.classList.add('hidden'); viewChordsDiv.classList.remove('hidden'); }
  window.showPracticeChords = () => { mainMenu.classList.add('hidden'); practiceChordsDiv.classList.remove('hidden'); }
  window.showStrum = () => { mainMenu.classList.add('hidden'); strumDiv.classList.remove('hidden'); }
  window.goBack = () => { 
    viewChordsDiv.classList.add('hidden'); 
    practiceChordsDiv.classList.add('hidden'); 
    strumDiv.classList.add('hidden'); 
    mainMenu.classList.remove('hidden'); 
  }

  // ----- Chord images array -----
  const images = [
    "c.png","a.png","d.png","g.png","e.png","em.png","am.png",
    "cmaj7.png","dm.png","f.png","fsharp.png","fsharpm.png",
    "b.png","bb.png","bm.png","csharpm.png","gsharpm.png"
  ];

  // View Chords
  const chordGridView = document.getElementById("chord-grid-view");
  images.forEach(filename => {
    const chordName = filename.split('.')[0].toLowerCase();
    const card = document.createElement("div");
    card.classList.add("chord-card");
    card.innerHTML = `<img src="images/${filename}" class="chord-img"><p>${chordName}</p>`;
    chordGridView.appendChild(card);
  });

  // ----- Chord Practice -----
  const chordSequence = ["C","G","Am","F"]; // Example progression
  let currentIndex = 0;
  let mistakes = 0;

  const currentChordDiv = document.getElementById("current-chord");
  const chordMistakes = document.getElementById("chord-mistakes");

  function showCurrentChord() {
    currentChordDiv.textContent = chordSequence[currentIndex];
  }

  window.restartChords = () => {
    currentIndex = 0; mistakes=0;
    chordMistakes.textContent=`You have (${mistakes}) mistakes wrong`;
    showCurrentChord();
  }

  showCurrentChord();

  document.getElementById("start-chord-rec").addEventListener('click', async ()=>{
    try{
      const stream = await navigator.mediaDevices.getUserMedia({audio:true});
      const mediaRecorder = new MediaRecorder(stream);
      let audioChunks = [];
      mediaRecorder.start();
      chordMistakes.textContent='Listening...';

      mediaRecorder.ondataavailable = e=>audioChunks.push(e.data);
      mediaRecorder.onstop = ()=>{
        const audioBlob = new Blob(audioChunks,{type:'audio/wav'});
        const audioUrl = URL.createObjectURL(audioBlob);
        // Here you would analyze audio to detect chord
        // Placeholder: randomly mark correct/wrong
        if(Math.random()<0.7){
          currentIndex = (currentIndex+1)%chordSequence.length;
        } else {
          mistakes++;
        }
        chordMistakes.textContent=`You have (${mistakes}) mistakes wrong`;
        showCurrentChord();
      }
      setTimeout(()=>mediaRecorder.stop(), 4000); // 4 sec recording
    } catch(err){
      chordMistakes.textContent='Mic access denied or not supported!';
      console.error(err);
    }
  });

  // ----- Strum Practice -----
  const songs = {
    'Huling El Bimbo': 'DD UUDD DU',
    '14': 'DD UDUDD DU',
    'Tadhana': 'DDU UDU',
    'Ikaw': 'D D U D U',
    'Narda': 'D DU D DU'
  };

  const songSelect = document.getElementById('song-select');
  for(const song in songs){
    const opt = document.createElement('option');
    opt.value = song; opt.textContent = song;
    songSelect.appendChild(opt);
  }

  const patternDisplay = document.getElementById('pattern-display');
  songSelect.addEventListener('change', ()=>{
    patternDisplay.textContent = songs[songSelect.value];
  });
  patternDisplay.textContent = songs[songSelect.value];

  let mediaRecorderStrum;
  let audioChunksStrum = [];
  const audioPlayback = document.getElementById('audio-playback');
  const strumStatus = document.getElementById('strum-status');

  document.getElementById('start-strum-rec').addEventListener('click', async ()=>{
    try{
      const stream = await navigator.mediaDevices.getUserMedia({audio:true});
      audioChunksStrum = [];
      mediaRecorderStrum = new MediaRecorder(stream);
      mediaRecorderStrum.start();
      strumStatus.textContent='Recording...';

      mediaRecorderStrum.ondataavailable = e=>audioChunksStrum.push(e.data);
      mediaRecorderStrum.onstop = ()=>{
        const audioBlob = new Blob(audioChunksStrum,{type:'audio/wav'});
        const audioUrl = URL.createObjectURL(audioBlob);
        audioPlayback.src = audioUrl;
        audioPlayback.classList.remove('hidden');
        strumStatus.textContent='Recording Complete!';
      }

      setTimeout(()=>mediaRecorderStrum.stop(),5000); // 5 sec record
    } catch(err){
      strumStatus.textContent='Mic access denied or not supported!';
      console.error(err);
    }
  });

  window.restartStrum = () => {
    audioPlayback.classList.add('hidden');
    audioPlayback.src='';
    strumStatus.textContent='Record your strum';
  }

});
</script>

</body>
</html>
